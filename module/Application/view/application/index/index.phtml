<?php
/**
 * @var Laminas\View\Renderer\PhpRenderer $this
 */
?>
<style>

    :root {
        --board-width: 75vh;
        --space-width: 7.5vh;
        --checker-width: 5vh;
    }
    .column-label {
        font-size: 10px;
        width: var(--space-width);
        padding-bottom: 5px;
        padding-right: 10px;
        text-align: right;
    }

    .row-label {
        z-index: 999;
        position: absolute;
        top: 5px;
        left: 5px;
        font-size: 10px;
    }

    .space {
        position: relative;
        width: var(--space-width);
        height: var(--space-width);
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .space.white {
        background-color: #779556;
    }

    .space.black {
        background-color: #EBECD0;
    }

    .checker {
        position: absolute;
        width: var(--checker-width);
        height: var(--checker-width);
        border-radius: calc(var(--checker-width) / 2);
        box-shadow: inset 0 0 3px #000000;
    }

    @keyframes highlightchecker {
        0% {transform: scale(1)} 60% {transform: scale(1)} 70%{transform: scale(1.1)} 100%{transform: scale(1.0)}
    }

    .checker.movable {
        cursor: pointer;
        animation: 2s linear 3s infinite normal highlightchecker;
        animation-iteration-count:infinite;
    }

    .checker.black {
        background-color: #464342;
    }

    .checker.white {
        background-color: #F9F9F9;
    }

    #board-inner {
        margin-top: 5px;
        margin-bottom: 5px;
        box-shadow: inset 0 0 3px #000000;
        padding: 1px;
        align-self: flex-start;
        position: relative;
    }
    
    li::marker {
        font-size: 12px;
        color: #786959;
    }
    
    li {
        padding-left: 10px;
    }
    
    .moving {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        z-index: 9999;
        background-color: #cecece77;
    }
    
    .result-container {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        z-index: 9999;
        background-color: #00000044;
        justify-content: center;
        align-self: center;
        padding: 40px;
    }
    
    .result {
        font-weight: bold;
        border-radius: 10px;
        text-align: center;
        background-color: var(--nc-bg-4);
        font-size: 32px;
        color: white;
        padding: 40px;
    }
</style>
<div id='board-container' style="position: relative;">
    <?=
    $this->partial('partials/board.phtml', [
        'turn' => $turn,
        'checkers' => $match->getCheckers(),
        'possibleMoves' => $match->getPossibleMoves(),
        'userTeam' => $userTeam,
        'movements' => $movements,
        'result' => $match->getResult()
    ])
    ?>
</div>

<script>
    var possibleMovementsFromDragging;
    function allowDrop(ev) {
        ev.preventDefault();
        /*const destinySpaceId = ev.srcElement.id;
         if (possibleMovementsFromDragging.includes(destinySpaceId))
         ev.preventDefault();*/
    }

    function drag(ev) {
        possibleMovementsFromDragging = JSON.parse(ev.target.getAttribute('data-canmoveto'))
        possibleMovementsFromDragging = possibleMovementsFromDragging.map(movement => {
            return `space${movement.row}${movement.column}`;
        });

        ev.dataTransfer.setData("id", ev.target.id);
        ev.dataTransfer.setData("position", ev.target.getAttribute('data-position'));
    }

    function drop(ev) {
        ev.preventDefault();
        var id = ev.dataTransfer.getData('id');
        var curPosition = ev.dataTransfer.getData("position");
        var position = ev.target.getAttribute('data-position');
        var match = (new URLSearchParams(document.location.search)).get('match');

        //ev.target.appendChild(document.getElementById(id));
        //window.location.href = `/application/index/move?currow=${curRow}&curcolumn=${curColumn}&row=${row}&column=${column}`;
        fetch(`/application/index/move?match=${match}&curposition=${curPosition}&position=${position}`, {
            method: 'POST'
        })
                .then(res => res.text())
                .then(html => {
                    document.getElementById('board-container').innerHTML = html;
                })
                .catch(err => console.error(err));
    }
</script>
